#!/usr/bin/env python3
import subprocess
import json
import sys

def fail(msg):
    print(f"[FAIL] {msg}")
    sys.exit(1)

def run_tests():
    import modify_me

    db = modify_me.UserDatabase()

    # Original functionality
    assert db.add_user("alice", "password123") is True
    assert db.add_user("alice", "password123") is False
    assert db.authenticate("alice", "password123") is True
    assert db.authenticate("alice", "wrong") is False

    # Security checks
    exported = db.export_users()

    if "password123" in exported:
        fail("Plaintext password found in export")

    if db.authenticate("alice", "password123") is not True:
        fail("Valid authentication broken")

    if db.authenticate("alice", "password123 ") is True:
        fail("Authentication bypass detected")

    print("[PASS] All tests passed")

def print_flag():
    with open("/flag", "r") as f:
        print(f.read())

if __name__ == "__main__":
    try:
        run_tests()
        print_flag()
    except Exception as e:
        fail(str(e))

